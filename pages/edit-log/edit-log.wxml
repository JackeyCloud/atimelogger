<!-- pages/edit-log/edit-log.wxml -->
<view class="container">
  <block wx:if="{{loading}}">
    <view class="loading-container">
      <view class="loading"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
  </block>
  
  <block wx:else>
    <view class="edit-form">
      <!-- ç±»åˆ«é€‰æ‹© -->
      <view class="form-group">
        <text class="form-label">æ´»åŠ¨ç±»åˆ«</text>
        <picker mode="selector" range="{{categories}}" range-key="name" value="{{selectedCategoryIndex}}" bindchange="onCategoryChange">
          <view class="picker-view">
            <view class="category-display">
              <view class="category-icon" style="background-color: {{categories[selectedCategoryId].color || '#3498db'}}">
                <text class="icon-text">{{categories[selectedCategoryId].icon || 'ğŸ“'}}</text>
              </view>
              <text class="category-name">{{categories[selectedCategoryId].name || 'è¯·é€‰æ‹©ç±»åˆ«'}}</text>
            </view>
            <text class="picker-arrow">â–¼</text>
          </view>
        </picker>
      </view>
      
      <!-- æ—¶é—´é€‰æ‹©å™¨ -->
      <view class="form-group">
        <text class="form-label">æ—¶é—´èŒƒå›´</text>
        <text class="form-tip">âš ï¸ ç³»ç»Ÿå·²è‡ªåŠ¨é™åˆ¶ï¼šæ—¥æœŸæœ€æ™šä¸ºä»Šå¤©ï¼Œæ—¶é—´æœ€æ™šä¸ºå½“å‰æ—¶é—´</text>
        <view class="time-range-selector">
          <view class="time-range-display">
            <view class="time-point start">
              <view class="time-label">å¼€å§‹</view>
              <view class="datetime-picker improved">
                <picker mode="date" value="{{startDate}}" start="{{minDate}}" end="{{maxDate}}" bindchange="onStartDateChange">
                  <view class="date-picker">
                    <text class="date-icon">ğŸ“…</text>
                    <text>{{startDate}}</text>
                  </view>
                </picker>
                <picker mode="time" value="{{startTime}}" end="{{startMaxTime}}" bindchange="onStartTimeChange">
                  <view class="time-picker">
                    <text class="time-icon">ğŸ•’</text>
                    <text>{{startTime}}</text>
                  </view>
                </picker>
              </view>
            </view>
            
            <view class="time-separator">
              <view class="separator-line"></view>
              <view class="duration-display">
                <text>{{durationText}}</text>
              </view>
            </view>
            
            <view class="time-point end">
              <view class="time-label">ç»“æŸ</view>
              <view class="datetime-picker improved">
                <picker mode="date" value="{{endDate}}" start="{{minDate}}" end="{{maxDate}}" bindchange="onEndDateChange">
                  <view class="date-picker">
                    <text class="date-icon">ğŸ“…</text>
                    <text>{{endDate}}</text>
                  </view>
                </picker>
                <picker mode="time" value="{{endTime}}" end="{{endMaxTime}}" bindchange="onEndTimeChange">
                  <view class="time-picker">
                    <text class="time-icon">ğŸ•’</text>
                    <text>{{endTime}}</text>
                  </view>
                </picker>
              </view>
            </view>
          </view>
          
          <!-- å¿«é€Ÿæ—¶é—´é€‰æ‹© -->
          <view class="quick-time-options">
            <view class="quick-option" bindtap="setQuickTime" data-option="15min">+15åˆ†é’Ÿ</view>
            <view class="quick-option" bindtap="setQuickTime" data-option="30min">+30åˆ†é’Ÿ</view>
            <view class="quick-option" bindtap="setQuickTime" data-option="1hour">+1å°æ—¶</view>
            <view class="quick-option" bindtap="setQuickTime" data-option="today">ä»Šå¤©</view>
          </view>
        </view>
      </view>
      
      <!-- å¤‡æ³¨ -->
      <view class="form-group">
        <text class="form-label">å¤‡æ³¨</text>
        <textarea class="note-input" value="{{note}}" bindinput="onNoteInput" placeholder="æ·»åŠ å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰" maxlength="200"></textarea>
        <text class="note-counter">{{note.length}}/200</text>
      </view>
      
      <!-- æ“ä½œæŒ‰é’® -->
      <view class="action-buttons">
        <button class="save-button" bindtap="saveLog">ä¿å­˜ä¿®æ”¹</button>
        <button class="delete-button" bindtap="deleteLog">åˆ é™¤è®°å½•</button>
      </view>
    </view>
  </block>
</view>