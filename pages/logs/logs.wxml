<!-- pages/logs/logs.wxml -->
<view class="container {{pageThemeClass}}">
  <!-- ç¼–è¾‘è®°å½•å¼¹çª— -->
  <view class="edit-modal" wx:if="{{showEditModal}}">
    <view class="modal-mask" bindtap="closeEditModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">ç¼–è¾‘è®°å½•</text>
        <view class="close-btn" bindtap="closeEditModal">Ã—</view>
      </view>
      
      <view class="modal-body">
        <view class="form-group">
          <text class="form-label">æ´»åŠ¨ç±»åˆ«</text>
          <view class="category-selector">
            <view class="current-category">
              <text>å½“å‰é€‰æ‹©ï¼š</text>
              <view class="selected-category-indicator">
                <block wx:for="{{categories}}" wx:key="id">
                  <block wx:if="{{editingLog.categoryId === item.id}}">
                    <view class="mini-category-icon" style="background-color: {{item.color}}">
                      <text class="mini-icon-text">{{item.icon}}</text>
                    </view>
                    <text class="selected-category-name">{{item.name}}</text>
                  </block>
                </block>
              </view>
            </view>
            <scroll-view scroll-x="true" class="categories-scroll" enhanced="true" show-scrollbar="false">
              <view class="categories-list">
                <block wx:for="{{categories}}" wx:key="id">
                  <view class="category-item {{editingLog.categoryId === item.id ? 'selected' : ''}}" 
                        bindtap="selectCategory" 
                        data-id="{{item.id}}"
                        hover-class="category-item-hover">
                    <view class="category-icon" style="background-color: {{item.color}}">
                      <text class="icon-text">{{item.icon}}</text>
                      <view wx:if="{{editingLog.categoryId === item.id}}" class="check-mark">âœ“</view>
                    </view>
                    <text class="category-name">{{item.name}}</text>
                  </view>
                </block>
              </view>
            </scroll-view>
          </view>
        </view>
        
        <view class="form-group">
          <text class="form-label">å¼€å§‹æ—¶é—´</text>
          <view class="enhanced-time-picker">
            <view class="time-picker-left">
              <text class="picker-label">æ—¥æœŸ</text>
              <picker mode="multiSelector" range="{{startDateRange}}" range-key="label" value="{{startDateIndex}}" bindchange="onStartDateMultiChange">
                <view class="date-picker-enhanced">
                  <text class="date-icon">ğŸ“…</text>
                  <text class="date-text">{{startDateDisplay}}</text>
                  <text class="picker-arrow">â–¼</text>
                </view>
              </picker>
            </view>
            <view class="time-picker-right">
              <text class="picker-label">æ—¶é—´</text>
              <picker mode="multiSelector" range="{{startTimeRange}}" range-key="label" value="{{startTimeIndex}}" bindchange="onStartTimeMultiChange">
                <view class="time-picker-enhanced">
                  <text class="time-icon">ğŸ•’</text>
                  <text class="time-text">{{startTimeDisplay}}</text>
                  <text class="picker-arrow">â–¼</text>
                </view>
              </picker>
            </view>
          </view>
        </view>
        
        <view class="form-group">
          <text class="form-label">ç»“æŸæ—¶é—´</text>
          <view class="enhanced-time-picker">
            <view class="time-picker-left">
              <text class="picker-label">æ—¥æœŸ</text>
              <picker mode="multiSelector" range="{{endDateRange}}" range-key="label" value="{{endDateIndex}}" bindchange="onEndDateMultiChange">
                <view class="date-picker-enhanced">
                  <text class="date-icon">ğŸ“…</text>
                  <text class="date-text">{{endDateDisplay}}</text>
                  <text class="picker-arrow">â–¼</text>
                </view>
              </picker>
            </view>
            <view class="time-picker-right">
              <text class="picker-label">æ—¶é—´</text>
              <picker mode="multiSelector" range="{{endTimeRange}}" range-key="label" value="{{endTimeIndex}}" bindchange="onEndTimeMultiChange">
                <view class="time-picker-enhanced">
                  <text class="time-icon">ğŸ•’</text>
                  <text class="time-text">{{endTimeDisplay}}</text>
                  <text class="picker-arrow">â–¼</text>
                </view>
              </picker>
            </view>
          </view>
        </view>
        
        <view class="form-group">
          <text class="form-label">æŒç»­æ—¶é—´</text>
          <text class="time-display">{{currentLog.formattedDuration}}</text>
        </view>
        
        <view class="form-group">
          <text class="form-label">å¤‡æ³¨</text>
          <textarea class="note-input" 
                    placeholder="æ·»åŠ å¤‡æ³¨..." 
                    value="{{currentLog.note}}" 
                    bindinput="inputNote"></textarea>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="delete-btn" bindtap="deleteLog">åˆ é™¤</button>
        <button class="save-btn" bindtap="saveLog">ä¿å­˜</button>
      </view>
    </view>
  </view>

  <view class="logs-container">
    <!-- æœç´¢å’Œç­›é€‰åŒºåŸŸ -->
    <view class="search-filter-container">
      <view class="search-box">
        <input class="search-input" placeholder="æœç´¢è®°å½•..." bindinput="onSearchInput" value="{{searchText}}" />
        <view class="search-icon" bindtap="onSearch">ğŸ”</view>
        <view class="clear-icon" bindtap="clearSearch" wx:if="{{searchText}}">Ã—</view>
      </view>
      
      <view class="filter-options">
        <view class="filter-button {{showFilters ? 'active' : ''}}" bindtap="toggleFilters">
          ç­›é€‰ <text class="filter-icon">{{showFilters ? 'â–²' : 'â–¼'}}</text>
          <text wx:if="{{activeFiltersCount > 0}}" class="filter-badge">{{activeFiltersCount}}</text>
        </view>
      </view>
    </view>
    
    <!-- å±•å¼€çš„ç­›é€‰é¢æ¿ -->
    <view class="filter-panel" wx:if="{{showFilters}}">
      <view class="filter-section">
        <text class="filter-section-title">æŒ‰ç±»åˆ«ç­›é€‰</text>
        <view class="category-filter-list">
          <view class="category-filter-item {{selectedCategoryId === 'all' ? 'selected' : ''}}" 
                bindtap="filterByCategory" data-id="all">
            <text>å…¨éƒ¨</text>
          </view>
          <block wx:for="{{categories}}" wx:key="id">
            <view class="category-filter-item {{selectedCategoryId === item.id ? 'selected' : ''}}" 
                  bindtap="filterByCategory" data-id="{{item.id}}">
              <view class="mini-category-icon" style="background-color: {{item.color}}">
                <text class="mini-icon-text">{{item.icon}}</text>
              </view>
              <text>{{item.name}}</text>
            </view>
          </block>
        </view>
      </view>
      
      <view class="filter-section">
        <text class="filter-section-title">æŒ‰æ—¶é—´èŒƒå›´ç­›é€‰</text>
        <view class="date-filter-list">
          <view class="date-filter-item {{dateFilter === 'all' ? 'selected' : ''}}" 
                bindtap="filterByDate" data-filter="all">
            <text>å…¨éƒ¨æ—¶é—´</text>
          </view>
          <view class="date-filter-item {{dateFilter === 'today' ? 'selected' : ''}}" 
                bindtap="filterByDate" data-filter="today">
            <text>ä»Šå¤©</text>
          </view>
          <view class="date-filter-item {{dateFilter === 'yesterday' ? 'selected' : ''}}" 
                bindtap="filterByDate" data-filter="yesterday">
            <text>æ˜¨å¤©</text>
          </view>
          <view class="date-filter-item {{dateFilter === 'thisWeek' ? 'selected' : ''}}" 
                bindtap="filterByDate" data-filter="thisWeek">
            <text>æœ¬å‘¨</text>
          </view>
          <view class="date-filter-item {{dateFilter === 'thisMonth' ? 'selected' : ''}}" 
                bindtap="filterByDate" data-filter="thisMonth">
            <text>æœ¬æœˆ</text>
          </view>
          <view class="date-filter-item {{dateFilter === 'custom' ? 'selected' : ''}}" 
                bindtap="filterByDate" data-filter="custom">
            <text>è‡ªå®šä¹‰...</text>
          </view>
        </view>
      </view>
      
      <view class="filter-section" wx:if="{{dateFilter === 'custom'}}">
        <view class="custom-date-range">
          <view class="date-picker-item">
            <text>å¼€å§‹æ—¥æœŸ:</text>
            <picker mode="date" value="{{customStartDate}}" bindchange="onStartDateChange">
              <view class="picker-value">{{customStartDate || 'é€‰æ‹©æ—¥æœŸ'}}</view>
            </picker>
          </view>
          <view class="date-picker-item">
            <text>ç»“æŸæ—¥æœŸ:</text>
            <picker mode="date" value="{{customEndDate}}" bindchange="onEndDateChange">
              <view class="picker-value">{{customEndDate || 'é€‰æ‹©æ—¥æœŸ'}}</view>
            </picker>
          </view>
        </view>
      </view>
      
      <view class="filter-actions">
        <button class="reset-filters-btn" bindtap="resetFilters">é‡ç½®ç­›é€‰</button>
        <button class="apply-filters-btn" bindtap="applyFilters">åº”ç”¨ç­›é€‰</button>
      </view>
    </view>
    
    <block wx:if="{{loading}}">
      <view class="loading-container">
        <view class="loading"></view>
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>
    </block>
    
    <block wx:elif="{{isEmpty}}">
      <view class="empty-state">
        <text class="empty-text">æš‚æ— è®°å½•</text>
        <text class="empty-subtext">å¼€å§‹è®°å½•ä½ çš„æ—¶é—´å§</text>
      </view>
    </block>
    
    <block wx:else>
      <view class="date-groups">
        <block wx:for="{{dateGroups}}" wx:key="date" wx:for-item="group">
          <view class="date-group">
            <view class="date-header">
              <text class="date-text">{{group.date}}</text>
              <text class="day-text">{{group.dayOfWeek}}</text>
            </view>
            
            <view class="logs-list">
              <block wx:for="{{group.logs}}" wx:key="id">
                <view class="log-item" bindtap="editLog" data-id="{{item.id}}">
                  <view class="log-content">
                    <view class="category-icon" style="background-color: {{item.category.color}}">
                      <text class="icon-text">{{item.category.icon}}</text>
                    </view>
                    
                    <view class="log-details">
                      <text class="log-title">{{item.category.name}}</text>
                      <text class="log-time">{{item.formattedStartTime}} - {{item.formattedEndTime}}</text>
                      <text class="log-duration">{{item.formattedDuration}}</text>
                      <text wx:if="{{item.note}}" class="log-note">{{item.note}}</text>
                    </view>
                  </view>
                </view>
              </block>
            </view>
          </view>
        </block>
      </view>
    </block>
  </view>
</view>